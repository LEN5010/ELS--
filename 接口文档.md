# Flutter交接文档

## 一、项目概述

### 1.1 项目信息

- **项目名称**: English Learning System (英语学习系统)
- **项目类型**: 跨平台移动应用（iOS/Android）
- **技术栈**: Flutter + Dart
- **后端API**: Python Flask REST API
- **目标用户**: 英语学习者

### 1.2 功能模块

1. **用户认证**: 注册、登录、Token管理
2. **学习模块**: 词汇学习、语法教程、听力练习
3. **测验模块**: 各类测验、成绩记录
4. **社区模块**: 讨论区、发帖评论
5. **个人中心**: 个人信息、学习进度

## 二、后端API说明

### 2.1 基础配置

```
基础URL: http://localhost:5001/api
响应格式: JSON
认证方式: JWT Token (Bearer Token)
```

### 2.2 通用响应格式

JSON

```
// 成功响应
{
    "code": 200,
    "message": "Success",
    "data": {} // 具体数据
}

// 错误响应
{
    "code": 400, // 错误码
    "message": "Error message",
    "data": null
}
```

### 2.3 API接口详细说明

#### 2.3.1 认证接口

**注册接口**

```
POST /api/auth/register
Content-Type: application/json

请求体:
{
    "email": "user@example.com",
    "password": "password123",
    "nickname": "John" // 可选，默认为邮箱前缀
}

成功响应:
{
    "code": 200,
    "message": "注册成功",
    "data": {
        "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
        "user_id": 1,
        "email": "user@example.com",
        "nickname": "John"
    }
}
```

**登录接口**

```
POST /api/auth/login
Content-Type: application/json

请求体:
{
    "email": "user@example.com",
    "password": "password123"
}

成功响应:
{
    "code": 200,
    "message": "登录成功",
    "data": {
        "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
        "user_id": 1,
        "email": "user@example.com",
        "nickname": "John",
        "role": "student" // student或admin
    }
}
```

#### 2.3.2 用户接口

**获取用户信息**

```
GET /api/user/profile/{user_id}
Authorization: Bearer {token}

成功响应:
{
    "code": 200,
    "message": "Success",
    "data": {
        "user_id": 1,
        "email": "user@example.com",
        "nickname": "John",
        "gender": "M", // M/F/U
        "birthday": "1990-01-01",
        "role": "student",
        "myps": "个人简介"
    }
}
```

**更新用户信息**

```
PUT /api/user/profile/{user_id}
Authorization: Bearer {token}
Content-Type: application/json

请求体:
{
    "nickname": "NewName",
    "gender": "M",
    "birthday": "1990-01-01",
    "myps": "新的个人简介"
}
```

**获取学习进度**

```
GET /api/user/progress/{user_id}
Authorization: Bearer {token}

成功响应:
{
    "code": 200,
    "message": "Success",
    "data": {
        "progress": {
            "user_id": 1,
            "vocab_learned": 50,
            "grammar_learned": 10,
            "listening_done": 5,
            "last_update": "2025-09-06 10:00:00"
        },
        "quiz_history": [
            {
                "result_id": 1,
                "quiz_id": 1,
                "title": "Basic Vocabulary Test",
                "quiz_type": "vocab",
                "score": 80,
                "correct_cnt": 4,
                "total_cnt": 5,
                "taken_at": "2025-09-06 09:00:00"
            }
        ]
    }
}
```

#### 2.3.3 学习资源接口

**获取词汇列表**

```
GET /api/learning/vocab?level=A1&page=1&per_page=20
Authorization: Bearer {token}

参数说明:
- level: 词汇等级 (A1/A2/B1/B2/C1/C2)
- page: 页码
- per_page: 每页数量

成功响应:
{
    "code": 200,
    "message": "Success",
    "data": {
        "total": 100,
        "page": 1,
        "per_page": 20,
        "data": [
            {
                "word_id": 1,
                "word": "hello",
                "meaning": "你好",
                "example": "Hello, how are you?",
                "level": "A1"
            }
        ]
    }
}
```

**获取语法教程**

```
GET /api/learning/grammar?level=A1
Authorization: Bearer {token}

成功响应:
{
    "code": 200,
    "message": "Success",
    "data": [
        {
            "grammar_id": 1,
            "title": "Present Simple",
            "content": "The present simple tense is used...",
            "level": "A1"
        }
    ]
}
```

**获取听力材料**

```
GET /api/learning/listening?level=A1
Authorization: Bearer {token}

成功响应:
{
    "code": 200,
    "message": "Success",
    "data": [
        {
            "listen_id": 1,
            "title": "Daily Conversation",
            "audio_url": "https://example.com/audio1.mp3",
            "transcript": "A: Hello! B: Hi, how are you?",
            "level": "A1"
        }
    ]
}
```

#### 2.3.4 测验接口

**获取测验列表**

```
GET /api/quiz/list?type=vocab
Authorization: Bearer {token}

参数说明:
- type: 测验类型 (vocab/grammar/listening) 可选

成功响应:
{
    "code": 200,
    "message": "Success",
    "data": [
        {
            "quiz_id": 1,
            "quiz_type": "vocab",
            "title": "Basic Vocabulary Test",
            "total_points": 100
        }
    ]
}
```

**获取测验题目**

```
GET /api/quiz/{quiz_id}/questions
Authorization: Bearer {token}

成功响应:
{
    "code": 200,
    "message": "Success",
    "data": {
        "quiz": {
            "quiz_id": 1,
            "quiz_type": "vocab",
            "title": "Basic Vocabulary Test",
            "total_points": 100
        },
        "questions": [
            {
                "question_id": 1,
                "question": "What does 'hello' mean?",
                "option_a": "你好",
                "option_b": "再见",
                "option_c": "谢谢",
                "option_d": "对不起",
                "score": 20
            }
        ]
    }
}
```

**提交测验答案**

```
POST /api/quiz/{quiz_id}/submit
Authorization: Bearer {token}
Content-Type: application/json

请求体:
{
    "user_id": 1,
    "answers": {
        "1": "A",  // question_id: selected_option
        "2": "B",
        "3": "A"
    }
}

成功响应:
{
    "code": 200,
    "message": "测验提交成功",
    "data": {
        "score": 80,
        "correct_count": 4,
        "total_count": 5,
        "accuracy": 80.00,
        "level": "Good" // Excellent/Good/Pass/Fail
    }
}
```

#### 2.3.5 社区接口

**获取帖子列表**

```
GET /api/community/posts?category=general&status=approved&page=1&per_page=20
Authorization: Bearer {token}

参数说明:
- category: 帖子类别 (general/question)
- status: 帖子状态 (pending/approved/rejected)
- page: 页码
- per_page: 每页数量

成功响应:
{
    "code": 200,
    "message": "Success",
    "data": {
        "total": 50,
        "page": 1,
        "per_page": 20,
        "data": [
            {
                "post_id": 1,
                "user_id": 1,
                "nickname": "John",
                "title": "How to improve vocabulary?",
                "content": "I want to know...",
                "category": "question",
                "status": "approved",
                "comment_count": 5,
                "created_at": "2025-09-06 10:00:00"
            }
        ]
    }
}
```

**创建帖子**

text



```
POST /api/community/posts
Authorization: Bearer {token}
Content-Type: application/json

请求体:
{
    "user_id": 1,
    "title": "My learning experience",
    "content": "I have been learning...",
    "category": "general" // general/question
}

成功响应:
{
    "code": 200,
    "message": "帖子创建成功",
    "data": {
        "post_id": 10
    }
}
```

**获取帖子详情**

```
GET /api/community/posts/{post_id}
Authorization: Bearer {token}

成功响应:
{
    "code": 200,
    "message": "Success",
    "data": {
        "post": {
            "post_id": 1,
            "user_id": 1,
            "nickname": "John",
            "title": "How to improve vocabulary?",
            "content": "I want to know...",
            "category": "question",
            "status": "approved",
            "created_at": "2025-09-06 10:00:00"
        },
        "comments": [
            {
                "comment_id": 1,
                "post_id": 1,
                "user_id": 2,
                "nickname": "Alice",
                "content": "You can try...",
                "created_at": "2025-09-06 11:00:00"
            }
        ]
    }
}
```

**发表评论**

```
POST /api/community/posts/{post_id}/comments
Authorization: Bearer {token}
Content-Type: application/json

请求体:
{
    "user_id": 1,
    "content": "This is my comment"
}

成功响应:
{
    "code": 200,
    "message": "评论成功",
    "data": {
        "comment_id": 10
    }
}
```